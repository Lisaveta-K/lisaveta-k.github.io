(function(r){function k(){var g=Array.prototype.slice.call(arguments),d=[],e;"string"==typeof g[0]&&(e=g.shift());s(g[0])&&(d=g.shift());g=g.shift();o[e]=[d,g]}function p(g){var d,e;if("undefined"==typeof n[g]&&(d=o[g]))e=d[0],d=d[1],n[g]=d.apply(void 0,t(e,function(b){var a=p,c;c=g.split("/");var b=b.split("/"),h=!1;for(c.pop();".."==b[0]&&c.length;)c.pop(),b.shift(),h=!0;"."==b[0]&&(b.shift(),h=!0);h&&(b=c.concat(b));c=b.join("/");return a(c)}));return n[g]}var o={},n={},s=Array.isArray||function(g){return g.constructor==
Array},t=Array.map||function(g,d,e){for(var b=0,a=g.length,c=[];b<a;b++)c.push(d.call(e,g[b]));return c};k("lib/utils",[],function(){var g=[];return{isDomObj:function(d){return!!(d.nodeType||d===window)},toArray:function(d,e){return g.slice.call(d,e)},merge:function(){for(var d=arguments.length,e=0,b=Array(d+1);e<d;e++)b[e+1]=arguments[e];if(0===d)return{};b[0]={};!0===b[b.length-1]&&(b.pop(),b.unshift(!0));return $.extend.apply(void 0,b)},push:function(d,e,b){d&&Object.keys(e||{}).forEach(function(a){if(d[a]&&
b)throw Error("utils.push attempted to overwrite '"+a+"' while running in protected mode");"object"==typeof d[a]&&"object"==typeof e[a]?this.push(d[a],e[a]):d[a]=e[a]},this);return d},isEnumerable:function(d,e){return-1<Object.keys(d).indexOf(e)},compose:function(){var d=arguments;return function(){for(var e=arguments,b=d.length-1;0<=b;b--)e=[d[b].apply(this,e)];return e[0]}},uniqueArray:function(d){for(var e={},b=[],a=0,c=d.length;a<c;++a)e.hasOwnProperty(d[a])||(b.push(d[a]),e[d[a]]=1);return b},
debounce:function(d,e,b){"number"!=typeof e&&(e=100);var a,c;return function(){var h=this,f=arguments,l=b&&!a;clearTimeout(a);a=setTimeout(function(){a=null;b||(c=d.apply(h,f))},e);l&&(c=d.apply(h,f));return c}},throttle:function(d,e){"number"!=typeof e&&(e=100);var b,a,c,h,f,l,i=this.debounce(function(){f=h=!1},e);return function(){b=this;a=arguments;c||(c=setTimeout(function(){c=null;f&&(l=d.apply(b,a));i()},e));h?f=!0:(h=!0,l=d.apply(b,a));i();return l}},countThen:function(d,e){return function(){if(!--d)return e.apply(this,
arguments)}},delegate:function(d){return function(e,b){var a=$(e.target),c;Object.keys(d).forEach(function(h){if((c=a.closest(h)).length)return b=b||{},b.el=c[0],d[h].apply(this,[e,b])},this)}}}});k("lib/debug",[],function(){function g(c,h,b){var b=b||{},f=b.obj||window,d=b.path||(f==window?"window":"");Object.keys(f).forEach(function(b){(a[c]||c)(h,f,b)&&console.log([d,".",b].join(""),"->",["(",typeof f[b],")"].join(""),f[b]);"[object Object]"==Object.prototype.toString.call(f[b])&&(f[b]!=f&&-1==
d.split(".").indexOf(b))&&g(c,h,{obj:f[b],path:[d,b].join(".")})})}function d(a,c,h,b){!c||typeof h==c?g(a,h,b):console.error([h,"must be",c].join(" "))}function e(){window.localStorage&&(localStorage.setItem("logFilter_eventNames",b.eventNames),localStorage.setItem("logFilter_actions",b.actions))}var b,a={name:function(a,c,h){return a==h},nameContains:function(a,c,h){return-1<h.indexOf(a)},type:function(a,c,h){return c[h]instanceof a},value:function(a,c,h){return c[h]===a},valueCoerced:function(a,
c,h){return c[h]==a}},c=[],h=[],f={eventNames:window.localStorage&&localStorage.getItem("logFilter_eventNames")||c,actions:window.localStorage&&localStorage.getItem("logFilter_actions")||h};Object.keys(f).forEach(function(a){var c=f[a];"string"==typeof c&&"all"!==c&&(f[a]=c.split(","))});b=f;return{enable:function(a){this.enabled=!!a;a&&window.console&&(console.info("Booting in DEBUG mode"),console.info("You can configure event logging with DEBUG.events.logAll()/logNone()/logByName()/logByAction()"));
window.DEBUG=this},find:{byName:function(a,c){d("name","string",a,c)},byNameContains:function(a,c){d("nameContains","string",a,c)},byType:function(a,c){d("type","function",a,c)},byValue:function(a,c){d("value",null,a,c)},byValueCoerced:function(a,c){d("valueCoerced",null,a,c)},custom:function(a,c){g(a,null,c)}},events:{logFilter:b,logByAction:function(){var a=[].slice.call(arguments);b.eventNames.length||(b.eventNames="all");b.actions=a.length?a:"all";e()},logByName:function(){var a=[].slice.call(arguments);
b.actions.length||(b.actions="all");b.eventNames=a.length?a:"all";e()},logAll:function(){b.actions="all";b.eventNames="all";e()},logNone:function(){b.actions=[];b.eventNames=[];e()}}}});k("lib/compose",["./utils","./debug"],function(g,d){function e(c,f){if(b){var d=Object.create(null);Object.keys(c).forEach(function(b){if(0>a.indexOf(b)){var e=Object.getOwnPropertyDescriptor(c,b);e.writable=f;d[b]=e}});Object.defineProperties(c,d)}}var b=d.enabled&&!g.isEnumerable(Object,"getOwnPropertyDescriptor"),
a=["mixedIn"];if(b)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(c){b=!1}return{mixin:function(a,c){a.mixedIn=a.hasOwnProperty("mixedIn")?a.mixedIn:[];c.forEach(function(c){-1==a.mixedIn.indexOf(c)&&(e(a,!1),c.call(a),a.mixedIn.push(c))});e(a,!0)},unlockProperty:function(a,c,d){var e;!b||!a.hasOwnProperty(c)?d.call(a):(e=Object.getOwnPropertyDescriptor(a,c).writable,Object.defineProperty(a,c,{writable:!0}),d.call(a),Object.defineProperty(a,c,{writable:e}))}}});k("lib/advice",["./utils",
"./compose"],function(g,d){var e={around:function(b,a){return function(){var c=0,h=arguments.length,f=Array(h+1);for(f[0]=b.bind(this);c<h;c++)f[c+1]=arguments[c];return a.apply(this,f)}},before:function(b,a){var c="function"==typeof a?a:a.obj[a.fnName];return function(){c.apply(this,arguments);return b.apply(this,arguments)}},after:function(b,a){var c="function"==typeof a?a:a.obj[a.fnName];return function(){var a=(b.unbound||b).apply(this,arguments);c.apply(this,arguments);return a}},withAdvice:function(){["before",
"after","around"].forEach(function(b){this[b]=function(a,c){d.unlockProperty(this,a,function(){return"function"==typeof this[a]?this[a]=e[b](this[a],c):this[a]=c})}},this)}};return e});k("lib/registry",["./utils"],function(){function g(d,b){var a,c,h;a=b.length;"function"===typeof b[a-1]&&(a-=1,h=b[a]);"object"===typeof b[a-1]&&(a-=1);2==a?(a=b[0],c=b[1]):(a=d.node,c=b[0]);return{element:a,type:c,callback:h}}function d(d,b){return d.element==b.element&&d.type==b.type&&(null==b.callback||d.callback==
b.callback)}return new function(){function e(c){this.component=c;this.attachedTo=[];this.instances={};this.addInstance=function(a){var c=new b(a);this.instances[a.identity]=c;this.attachedTo.push(a.node);return c};this.removeInstance=function(c){delete this.instances[c.identity];c=this.attachedTo.indexOf(c.node);-1<c&&this.attachedTo.splice(c,1);Object.keys(this.instances).length||a.removeComponentInfo(this)};this.isAttachedTo=function(a){return-1<this.attachedTo.indexOf(a)}}function b(c){this.instance=
c;this.events=[];this.addBind=function(c){this.events.push(c);a.events.push(c)};this.removeBind=function(a){for(var c=0,b;b=this.events[c];c++)d(b,a)&&this.events.splice(c,1)}}var a=this;(this.reset=function(){this.components=[];this.allInstances={};this.events=[]}).call(this);this.addInstance=function(a){var b=this.findComponentInfo(a);b||(b=new e(a.constructor),this.components.push(b));var f=b.addInstance(a);this.allInstances[a.identity]=f;return b};this.removeInstance=function(a){this.findInstanceInfo(a);
var b=this.findComponentInfo(a);b&&b.removeInstance(a);delete this.allInstances[a.identity]};this.removeComponentInfo=function(a){a=this.components.indexOf(a);-1<a&&this.components.splice(a,1)};this.findComponentInfo=function(a){for(var a=a.attachTo?a:a.constructor,b=0,f;f=this.components[b];b++)if(f.component===a)return f;return null};this.findInstanceInfo=function(a){return this.allInstances[a.identity]||null};this.findInstanceInfoByNode=function(a){var b=[];Object.keys(this.allInstances).forEach(function(f){f=
this.allInstances[f];f.instance.node===a&&b.push(f)},this);return b};this.on=function(c){var b=a.findInstanceInfo(this),f;f=arguments.length;for(var d=1,e=Array(f-1);d<f;d++)e[d-1]=arguments[d];b&&((f=c.apply(null,e))&&(e[e.length-1]=f),e=g(this,e),b.addBind(e))};this.off=function(c,b,f){var e=g(this,arguments),i=a.findInstanceInfo(this);i&&i.removeBind(e);for(var i=0,j;j=a.events[i];i++)d(j,e)&&a.events.splice(i,1)};a.trigger=new Function;this.teardown=function(){a.removeInstance(this)};this.withRegistration=
function(){this.after("initialize",function(){a.addInstance(this)});this.around("on",a.on);this.after("off",a.off);window.DEBUG&&DEBUG.enabled&&this.after("trigger",a.trigger);this.after("teardown",{obj:a,fnName:"teardown"})}}});k("lib/base",["./utils","./registry","./debug"],function(g,d,e){var b=0;return function(){this.trigger=function(){var a,c,b,d,g;a=arguments.length-1;c=arguments[a];if("string"!=typeof c&&(!c||!c.defaultBehavior))a--,b=c;1==a?(a=$(arguments[0]),d=arguments[1]):(a=this.$node,
d=arguments[0]);d.defaultBehavior&&(g=d.defaultBehavior,d=$.Event(d.type));c=d.type||d;if(e.enabled&&window.postMessage){var i=b;try{window.postMessage(i,"*")}catch(j){throw console.log("unserializable data for event",c,":",i),Error(["The event",c,"on component",this.toString(),"was triggered with non-serializable data"].join(" "));}}"object"===typeof this.attr.eventData&&(b=$.extend(!0,{},this.attr.eventData,b));a.trigger(d||c,b);g&&!d.isDefaultPrevented()&&(this[g]||g).call(this);return a};this.on=
function(){var a,c,b,d;a=arguments.length-1;d=arguments[a];d="object"==typeof d?g.delegate(this.resolveDelegateRules(d)):d;2==a?(a=$(arguments[0]),c=arguments[1]):(a=this.$node,c=arguments[0]);if("function"!=typeof d&&"object"!=typeof d)throw Error("Unable to bind to '"+c+"' because the given callback is not a function or an object");b=d.bind(this);b.target=d;d.guid&&(b.guid=d.guid);a.on(c,b);d.guid=b.guid;return b};this.off=function(){var a,c,b;a=arguments.length-1;"function"==typeof arguments[a]&&
(b=arguments[a],a-=1);1==a?(a=$(arguments[0]),c=arguments[1]):(a=this.$node,c=arguments[0]);return a.off(c,b)};this.resolveDelegateRules=function(a){var c={};Object.keys(a).forEach(function(b){if(!(b in this.attr))throw Error('Component "'+this.toString()+'" wants to listen on "'+b+'" but no such attribute was defined.');c[this.attr[b]]=a[b]},this);return c};this.defaultAttrs=function(a){g.push(this.defaults,a,!0)||(this.defaults=a)};this.select=function(a){return this.$node.find(this.attr[a])};this.initialize=
function(a,c){c=c||{};this.identity=b++;if(!a)throw Error("Component needs a node");a.jquery?(this.node=a[0],this.$node=a):(this.node=a,this.$node=$(a));var d=Object.create(c),e;for(e in this.defaults)c.hasOwnProperty(e)||(d[e]=this.defaults[e]);this.attr=d;Object.keys(this.defaults||{}).forEach(function(a){if(this.defaults[a]===null&&this.attr[a]===null)throw Error('Required attribute "'+a+'" not specified in attachTo for component "'+this.toString()+'".');},this);return this};this.teardown=function(){var a=
d.findInstanceInfo(this);a.events.slice().forEach(function(a){var b=[a.type];a.element&&b.unshift(a.element);"function"==typeof a.callback&&b.push(a.callback);this.off.apply(this,b)},a.instance)}}});k("lib/logger",["./compose","./utils"],function(g,d){function e(a){var b=(a.tagName?a.tagName.toLowerCase():a.toString())+(a.className?"."+a.className:"");return a.tagName?["'","'"].join(b):b}function b(b,d,f){var g,i,j,q;"function"==typeof f[f.length-1]&&f.pop();"object"==typeof f[f.length-1]&&f.pop();
2==f.length?(i=f[0],g=f[1]):(i=d.$node[0],g=f[0]);window.DEBUG&&window.DEBUG.enabled&&(j=DEBUG.events.logFilter,f="all"==j.actions||-1<j.actions.indexOf(b),q=function(a){return a.test?a:RegExp("^"+a.replace(/\*/g,".*")+"$")},j="all"==j.eventNames||j.eventNames.some(function(a){return q(a).test(g)}),f&&j&&console.info(a[b],b,"["+g+"]",e(i),d.constructor.describe.split(" ").slice(0,3).join(" ")))}var a={on:"<-",trigger:"->",off:"x "};return function(){this.before("trigger",function(){b("trigger",this,
d.toArray(arguments))});this.before("on",function(){b("on",this,d.toArray(arguments))});this.before("off",function(a){b("off",this,d.toArray(arguments))})}});k("lib/component","./advice ./utils ./compose ./base ./registry ./logger ./debug".split(" "),function(g,d,e,b,a,c,h){function f(){var b=a.findComponentInfo(this);b&&Object.keys(b.instances).forEach(function(a){b.instances[a].instance.teardown()})}function k(b){for(var c=arguments.length,e=Array(c-1),f=1;f<c;f++)e[f-1]=arguments[f];if(!b)throw Error("Component needs to be attachTo'd a jQuery object, native node or selector string");
var g=d.merge.apply(d,e);$(b).each(function(b,c){var d=c.jQuery?c[0]:c,e=a.findComponentInfo(this);(!e||!e.isAttachedTo(d))&&(new this).initialize(c,g)}.bind(this))}function i(){for(var d=arguments.length,i=Array(d+3),m=0;m<d;m++)i[m]=arguments[m];d=function(){};d.toString=d.prototype.toString=function(){return i.map(function(a){if(a.name==null)return(a=a.toString().match(j))&&a[1]?a[1]:"";return a.name!="withBase"?a.name:""}).filter(Boolean).join(", ")};if(h.enabled)d.describe=d.prototype.describe=
d.toString();d.attachTo=k;d.teardownAll=f;h.enabled&&i.unshift(c);i.unshift(b,g.withAdvice,a.withRegistration);e.mixin(d.prototype,i);return d}var j=/function (.*?)\s?\(/;i.teardownAll=function(){a.components.slice().forEach(function(a){a.component.teardownAll()});a.reset()};return i});k("lib/index","./advice ./component ./compose ./logger ./registry ./utils".split(" "),function(g,d,e,b,a,c){return{advice:g,component:d,compose:e,logger:b,registry:a,utils:c}});r.flight=p("lib/index")})(this);
